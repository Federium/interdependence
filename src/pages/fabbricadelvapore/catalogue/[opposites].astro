---

import Contenuto from "../../../layouts/Contenuto.astro";
import Heading from "../../../components/Heading.astro";
import ProjectsLayout from "../../../layouts/ProjectsLayout.astro";
import ProjectCard from "../../../components/ProjectCard.astro";

import { getCollection } from 'astro:content';
import categories from '../../../assets/data/categories.json'; 
import Project from "./[opposites]/[project].astro";

// Funzione per generare i percorsi statici per ogni categoria a partire dallo slug
export async function getStaticPaths() { 
  return categories.map(category => ({
    params: { opposites: category.slug },
    props: { category },
  }));
}

const { opposites } = Astro.params; // prende lo slug dalla URL

const category = categories.find(cat => cat.slug === opposites);

if (!category) {
  throw new Error(`Categoria non trovata per slug: ${opposites}`);
}

// Prendiamo tutti i progetti che appartengono a questa categoria
const projects = await getCollection('projects', (entry) => entry.data.category === category.id);

---

 <Contenuto name="Catalogue">
  <Heading title="Catalogue" subtitle="Fabbrica del Vapore" background={true}>
  </Heading>
  <ProjectsLayout category={category} isSingleProject = {false}>


  <div class="cards-container"> 
    {projects.map((project) => (
      <ProjectCard folder={opposites} projectId={project.data.id} title={project.data.title} slug={project.data.slug} />
    ))}


  </ProjectsLayout>
 

  </div>
  </div>

</Contenuto>

<style>
.cards-container {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}
</style>

