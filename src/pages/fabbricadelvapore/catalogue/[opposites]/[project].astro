---
import { getCollection } from 'astro:content';
import categories from '../../../../assets/data/categories.json';
import Contenuto from '../../../../layouts/Contenuto.astro';
import Heading from '../../../../components/Heading.astro';
import ProjectsLayout from '../../../../layouts/ProjectsLayout.astro';

// 1. Generiamo correttamente i percorsi con entrambi i parametri
export async function getStaticPaths() {
  const projects = await getCollection('projects');

  return projects.map(project => {
    const categoryInfo = categories.find(cat => cat.id === project.data.category);
    if (!categoryInfo) throw new Error(`Categoria non trovata per ID: ${project.data.category}`);
    
    return {
      params: { 
        opposites: categoryInfo.slug,
        project: project.data.slug 
      },
      props: { project },
    };
  });
}

const { project } = Astro.props;
const { opposites } = Astro.params;

const { data } = project;

const category = categories.find(cat => cat.id === data.category);
if (!category) {
  throw new Error(`Categoria non trovata per ID: ${data.category}`);
} 
---


<Contenuto name="Catalogue">
  <Heading title="Catalogue" subtitle="Fabbrica del Vapore" background={true}>
  </Heading>
  <ProjectsLayout category={category} isSingleProject = {true}>


    <h1>{data.title}</h1>
    <p><strong>Categoria:</strong> {data.category}</p>
    <p><strong>Anno:</strong> {data.ay}</p>
    
    {data.project_website && (
      <p><a href={data.project_website} target="_blank">Sito del progetto</a></p>
    )}

    {data.school_website && (
      <p><a href={data.school_website} target="_blank">Sito della scuola</a></p>
    )}

    <article>
    </article>

  </ProjectsLayout>

</Contenuto>


<style>
  h1,p {
    color: black;
  }
</style>